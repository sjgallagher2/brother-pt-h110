#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Mon Dec 23 11:29:57 2024

@author: sam

Generate dot matrix display from hex
"""

import matplotlib as mpl
import matplotlib.pyplot as plt
import numpy as np

def hextobin(h):
    # https://stackoverflow.com/questions/1425493/convert-hex-to-binary/28913296#28913296
    binstr = bin(int(h, 16))[2:].zfill(len(h) * 4)
    binlist = list(binstr)
    binlist = [int(b) for b in binlist]
    binarr = np.array(binlist)
    return binarr

#mat = np.ones((16,128))
# %%
h = 'F000000000000000000000000000000000000800800002000C0080100000000000000000080080000200100080100000000000000000240080000200100080000000000000000000240080000200100080000000000000000000E278B8383A387C3AB810787878787C0000002284C44446441046C4108484848482000000220482808282108282100404040482000000223C828082FE108282103C3C3C3C6000000022448280828010828210444444441C000000248482808280104682108484848482000000248CC4444642103A82108C8C8C8C820000000872B8383A3C10028210727272727C000000080000000000008200000000000000000000F00000000000007C00000000000000000000000000000000000000000000000000FF00001101C0001101C2001101C4001101C4001101C3001101C6001101C8001101CC801101CE211101CF041101CF041101CF041101CA001101CA001101CA001101CA001101CA001101CA001101CA001101CB001101CB001101CC801101CC801101CC801101CB001101CC801101CD021101CD021101CD021101CD021101CE211101CD021101CE211101CE211101CE211101CF041101CE211101CF041101CE211101CF041000C3001000C1001000C0421000C8001000C6001000C5601000CA001000CB001000CD001000CE001000CF001000C0421000CF001000C560'
def plot_hex_with_os(h, ax, ncols=128,col_first=True):    
    harr = hextobin(h)
    hsz = len(harr)
    hcvec = np.reshape(harr,(hsz,1))  # convert to col vec
    # Column first
    if col_first:
        hmat = np.reshape(harr,(hsz//16,16)).T
    else:  # row first
        nrows = hsz // ncols 
        if hsz % ncols != 0:
            nrows += 1
        hpad = np.pad(harr,(0,nrows*ncols - hsz))
        hmat = np.reshape(hpad,(nrows,ncols))
    
    ax.imshow(hmat,vmin=0,vmax=1,cmap='gray')

#h2 = '0x8888888860E33A2F34B1436C92A1B22208'
#h3 = '50403D100100000000000000000000080080000280100000000000080080100080100000000000240200100080000000000080000200100000000000E278B8383AB81078787800002284C41046C41084820000002282821082820404820000828082FE103C3C3C3C60224482808282104444440000248482104682108482000000244642103A828C8C820000B8383A3C10727272727C080000000000000000000000F00000007C00000000000000000000000000000000FF00C0001101C2C4001101C4C3001101C6C8001101CCCE211101CFCF041101CFCA001101CACA001101CACA001101CACA001101CBCB001101CCCC801101CCCB001101CCCD021101CDCD021101CDCE211101CDCE211101CECE211101CFCE211101CFCE211101CFC3001000C1C0421000C8C6001000C5CA001000CBCD001000CECF001000C0CF001000C5'

# %%
naxes = 2
fig,axs = plt.subplots(naxes,1,figsize=(14.25,8))
# plot_hex_with_os(h[:144*4], axs[0], ncols=144, col_first=False)
plot_hex_with_os(h[144*4+1:], axs[1], ncols=144, col_first=False)

# for os in range(naxes):
#     plot_hex_with_os(h, axs[os],ncols=os+base_cols,col_first=False)
    

fig.tight_layout()